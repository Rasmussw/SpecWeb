import { Injectable } from '@angular/core';
import { concatMap } from 'rxjs/operators';
import * as i0 from "@angular/core";
import * as i1 from "./callback-handling/code-flow-callback-handler.service";
import * as i2 from "./callback-handling/implicit-flow-callback-handler.service";
import * as i3 from "./callback-handling/history-jwt-keys-callback-handler.service";
import * as i4 from "./callback-handling/user-callback-handler.service";
import * as i5 from "./callback-handling/state-validation-callback-handler.service";
import * as i6 from "./callback-handling/refresh-session-callback-handler.service";
import * as i7 from "./callback-handling/refresh-token-callback-handler.service";
class FlowsService {
    constructor(codeFlowCallbackHandlerService, implicitFlowCallbackHandlerService, historyJwtKeysCallbackHandlerService, userHandlerService, stateValidationCallbackHandlerService, refreshSessionCallbackHandlerService, refreshTokenCallbackHandlerService) {
        this.codeFlowCallbackHandlerService = codeFlowCallbackHandlerService;
        this.implicitFlowCallbackHandlerService = implicitFlowCallbackHandlerService;
        this.historyJwtKeysCallbackHandlerService = historyJwtKeysCallbackHandlerService;
        this.userHandlerService = userHandlerService;
        this.stateValidationCallbackHandlerService = stateValidationCallbackHandlerService;
        this.refreshSessionCallbackHandlerService = refreshSessionCallbackHandlerService;
        this.refreshTokenCallbackHandlerService = refreshTokenCallbackHandlerService;
    }
    processCodeFlowCallback(urlToCheck, config, allConfigs) {
        return this.codeFlowCallbackHandlerService
            .codeFlowCallback(urlToCheck, config)
            .pipe(concatMap((callbackContext) => this.codeFlowCallbackHandlerService.codeFlowCodeRequest(callbackContext, config)), concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processSilentRenewCodeFlowCallback(firstContext, config, allConfigs) {
        return this.codeFlowCallbackHandlerService
            .codeFlowCodeRequest(firstContext, config)
            .pipe(concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processImplicitFlowCallback(config, allConfigs, hash) {
        return this.implicitFlowCallbackHandlerService
            .implicitFlowCallback(config, allConfigs, hash)
            .pipe(concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    processRefreshToken(config, allConfigs, customParamsRefresh) {
        return this.refreshSessionCallbackHandlerService
            .refreshSessionWithRefreshTokens(config)
            .pipe(concatMap((callbackContext) => this.refreshTokenCallbackHandlerService.refreshTokensRequestTokens(callbackContext, config, customParamsRefresh)), concatMap((callbackContext) => this.historyJwtKeysCallbackHandlerService.callbackHistoryAndResetJwtKeys(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.stateValidationCallbackHandlerService.callbackStateValidation(callbackContext, config, allConfigs)), concatMap((callbackContext) => this.userHandlerService.callbackUser(callbackContext, config, allConfigs)));
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, deps: [{ token: i1.CodeFlowCallbackHandlerService }, { token: i2.ImplicitFlowCallbackHandlerService }, { token: i3.HistoryJwtKeysCallbackHandlerService }, { token: i4.UserCallbackHandlerService }, { token: i5.StateValidationCallbackHandlerService }, { token: i6.RefreshSessionCallbackHandlerService }, { token: i7.RefreshTokenCallbackHandlerService }], target: i0.ɵɵFactoryTarget.Injectable }); }
    static { this.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, providedIn: 'root' }); }
}
export { FlowsService };
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "16.0.2", ngImport: i0, type: FlowsService, decorators: [{
            type: Injectable,
            args: [{ providedIn: 'root' }]
        }], ctorParameters: function () { return [{ type: i1.CodeFlowCallbackHandlerService }, { type: i2.ImplicitFlowCallbackHandlerService }, { type: i3.HistoryJwtKeysCallbackHandlerService }, { type: i4.UserCallbackHandlerService }, { type: i5.StateValidationCallbackHandlerService }, { type: i6.RefreshSessionCallbackHandlerService }, { type: i7.RefreshTokenCallbackHandlerService }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmxvd3Muc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItYXV0aC1vaWRjLWNsaWVudC9zcmMvbGliL2Zsb3dzL2Zsb3dzLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUUzQyxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7Ozs7Ozs7OztBQVczQyxNQUNhLFlBQVk7SUFDdkIsWUFDbUIsOEJBQThELEVBQzlELGtDQUFzRSxFQUN0RSxvQ0FBMEUsRUFDMUUsa0JBQThDLEVBQzlDLHFDQUE0RSxFQUM1RSxvQ0FBMEUsRUFDMUUsa0NBQXNFO1FBTnRFLG1DQUE4QixHQUE5Qiw4QkFBOEIsQ0FBZ0M7UUFDOUQsdUNBQWtDLEdBQWxDLGtDQUFrQyxDQUFvQztRQUN0RSx5Q0FBb0MsR0FBcEMsb0NBQW9DLENBQXNDO1FBQzFFLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBNEI7UUFDOUMsMENBQXFDLEdBQXJDLHFDQUFxQyxDQUF1QztRQUM1RSx5Q0FBb0MsR0FBcEMsb0NBQW9DLENBQXNDO1FBQzFFLHVDQUFrQyxHQUFsQyxrQ0FBa0MsQ0FBb0M7SUFDdEYsQ0FBQztJQUVKLHVCQUF1QixDQUNyQixVQUFrQixFQUNsQixNQUEyQixFQUMzQixVQUFpQztRQUVqQyxPQUFPLElBQUksQ0FBQyw4QkFBOEI7YUFDdkMsZ0JBQWdCLENBQUMsVUFBVSxFQUFFLE1BQU0sQ0FBQzthQUNwQyxJQUFJLENBQ0gsU0FBUyxDQUFDLENBQUMsZUFBZSxFQUFFLEVBQUUsQ0FDNUIsSUFBSSxDQUFDLDhCQUE4QixDQUFDLG1CQUFtQixDQUNyRCxlQUFlLEVBQ2YsTUFBTSxDQUNQLENBQ0YsRUFDRCxTQUFTLENBQUMsQ0FBQyxlQUFlLEVBQUUsRUFBRSxDQUM1QixJQUFJLENBQUMsb0NBQW9DLENBQUMs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QUNYLENBQ0YsQ0FDRixDQUFDO0lBQ04sQ0FBQzs4R0F0SlUsWUFBWTtrSEFBWixZQUFZLGNBREMsTUFBTTs7U0FDbkIsWUFBWTsyRkFBWixZQUFZO2tCQUR4QixVQUFVO21CQUFDLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xyXG5pbXBvcnQgeyBjb25jYXRNYXAgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XHJcbmltcG9ydCB7IE9wZW5JZENvbmZpZ3VyYXRpb24gfSBmcm9tICcuLi9jb25maWcvb3BlbmlkLWNvbmZpZ3VyYXRpb24nO1xyXG5pbXBvcnQgeyBDYWxsYmFja0NvbnRleHQgfSBmcm9tICcuL2NhbGxiYWNrLWNvbnRleHQnO1xyXG5pbXBvcnQgeyBDb2RlRmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL2NvZGUtZmxvdy1jYWxsYmFjay1oYW5kbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBIaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL2hpc3Rvcnktand0LWtleXMtY2FsbGJhY2staGFuZGxlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgSW1wbGljaXRGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZSB9IGZyb20gJy4vY2FsbGJhY2staGFuZGxpbmcvaW1wbGljaXQtZmxvdy1jYWxsYmFjay1oYW5kbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSZWZyZXNoU2Vzc2lvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL3JlZnJlc2gtc2Vzc2lvbi1jYWxsYmFjay1oYW5kbGVyLnNlcnZpY2UnO1xyXG5pbXBvcnQgeyBSZWZyZXNoVG9rZW5DYWxsYmFja0hhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnLi9jYWxsYmFjay1oYW5kbGluZy9yZWZyZXNoLXRva2VuLWNhbGxiYWNrLWhhbmRsZXIuc2VydmljZSc7XHJcbmltcG9ydCB7IFN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL3N0YXRlLXZhbGlkYXRpb24tY2FsbGJhY2staGFuZGxlci5zZXJ2aWNlJztcclxuaW1wb3J0IHsgVXNlckNhbGxiYWNrSGFuZGxlclNlcnZpY2UgfSBmcm9tICcuL2NhbGxiYWNrLWhhbmRsaW5nL3VzZXItY2FsbGJhY2staGFuZGxlci5zZXJ2aWNlJztcclxuXHJcbkBJbmplY3RhYmxlKHsgcHJvdmlkZWRJbjogJ3Jvb3QnIH0pXHJcbmV4cG9ydCBjbGFzcyBGbG93c1NlcnZpY2Uge1xyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSBjb2RlRmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2U6IENvZGVGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgaW1wbGljaXRGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZTogSW1wbGljaXRGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZSxcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgaGlzdG9yeUp3dEtleXNDYWxsYmFja0hhbmRsZXJTZXJ2aWNlOiBIaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHVzZXJIYW5kbGVyU2VydmljZTogVXNlckNhbGxiYWNrSGFuZGxlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2U6IFN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UsXHJcbiAgICBwcml2YXRlIHJlYWRvbmx5IHJlZnJlc2hTZXNzaW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZTogUmVmcmVzaFNlc3Npb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlLFxyXG4gICAgcHJpdmF0ZSByZWFkb25seSByZWZyZXNoVG9rZW5DYWxsYmFja0hhbmRsZXJTZXJ2aWNlOiBSZWZyZXNoVG9rZW5DYWxsYmFja0hhbmRsZXJTZXJ2aWNlXHJcbiAgKSB7fVxyXG5cclxuICBwcm9jZXNzQ29kZUZsb3dDYWxsYmFjayhcclxuICAgIHVybFRvQ2hlY2s6IHN0cmluZyxcclxuICAgIGNvbmZpZzogT3BlbklkQ29uZmlndXJhdGlvbixcclxuICAgIGFsbENvbmZpZ3M6IE9wZW5JZENvbmZpZ3VyYXRpb25bXVxyXG4gICk6IE9ic2VydmFibGU8Q2FsbGJhY2tDb250ZXh0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5jb2RlRmxvd0NhbGxiYWNrSGFuZGxlclNlcnZpY2VcclxuICAgICAgLmNvZGVGbG93Q2FsbGJhY2sodXJsVG9DaGVjaywgY29uZmlnKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMuY29kZUZsb3dDYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNvZGVGbG93Q29kZVJlcXVlc3QoXHJcbiAgICAgICAgICAgIGNhbGxiYWNrQ29udGV4dCxcclxuICAgICAgICAgICAgY29uZmlnXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSxcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeUp3dEtleXNDYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrSGlzdG9yeUFuZFJlc2V0Snd0S2V5cyhcclxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxyXG4gICAgICAgICAgICBjb25maWcsXHJcbiAgICAgICAgICAgIGFsbENvbmZpZ3NcclxuICAgICAgICAgIClcclxuICAgICAgICApLFxyXG4gICAgICAgIGNvbmNhdE1hcCgoY2FsbGJhY2tDb250ZXh0KSA9PlxyXG4gICAgICAgICAgdGhpcy5zdGF0ZVZhbGlkYXRpb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrU3RhdGVWYWxpZGF0aW9uKFxyXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXHJcbiAgICAgICAgICAgIGNvbmZpZyxcclxuICAgICAgICAgICAgYWxsQ29uZmlnc1xyXG4gICAgICAgICAgKVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XHJcbiAgICAgICAgICB0aGlzLnVzZXJIYW5kbGVyU2VydmljZS5jYWxsYmFja1VzZXIoXHJcbiAgICAgICAgICAgIGNhbGxiYWNrQ29udGV4dCxcclxuICAgICAgICAgICAgY29uZmlnLFxyXG4gICAgICAgICAgICBhbGxDb25maWdzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJvY2Vzc1NpbGVudFJlbmV3Q29kZUZsb3dDYWxsYmFjayhcclxuICAgIGZpcnN0Q29udGV4dDogQ2FsbGJhY2tDb250ZXh0LFxyXG4gICAgY29uZmlnOiBPcGVuSWRDb25maWd1cmF0aW9uLFxyXG4gICAgYWxsQ29uZmlnczogT3BlbklkQ29uZmlndXJhdGlvbltdXHJcbiAgKTogT2JzZXJ2YWJsZTxDYWxsYmFja0NvbnRleHQ+IHtcclxuICAgIHJldHVybiB0aGlzLmNvZGVGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZVxyXG4gICAgICAuY29kZUZsb3dDb2RlUmVxdWVzdChmaXJzdENvbnRleHQsIGNvbmZpZylcclxuICAgICAgLnBpcGUoXHJcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XHJcbiAgICAgICAgICB0aGlzLmhpc3RvcnlKd3RLZXlzQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5jYWxsYmFja0hpc3RvcnlBbmRSZXNldEp3dEtleXMoXHJcbiAgICAgICAgICAgIGNhbGxiYWNrQ29udGV4dCxcclxuICAgICAgICAgICAgY29uZmlnLFxyXG4gICAgICAgICAgICBhbGxDb25maWdzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSxcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMuc3RhdGVWYWxpZGF0aW9uQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5jYWxsYmFja1N0YXRlVmFsaWRhdGlvbihcclxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxyXG4gICAgICAgICAgICBjb25maWcsXHJcbiAgICAgICAgICAgIGFsbENvbmZpZ3NcclxuICAgICAgICAgIClcclxuICAgICAgICApLFxyXG4gICAgICAgIGNvbmNhdE1hcCgoY2FsbGJhY2tDb250ZXh0KSA9PlxyXG4gICAgICAgICAgdGhpcy51c2VySGFuZGxlclNlcnZpY2UuY2FsbGJhY2tVc2VyKFxyXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXHJcbiAgICAgICAgICAgIGNvbmZpZyxcclxuICAgICAgICAgICAgYWxsQ29uZmlnc1xyXG4gICAgICAgICAgKVxyXG4gICAgICAgIClcclxuICAgICAgKTtcclxuICB9XHJcblxyXG4gIHByb2Nlc3NJbXBsaWNpdEZsb3dDYWxsYmFjayhcclxuICAgIGNvbmZpZzogT3BlbklkQ29uZmlndXJhdGlvbixcclxuICAgIGFsbENvbmZpZ3M6IE9wZW5JZENvbmZpZ3VyYXRpb25bXSxcclxuICAgIGhhc2g/OiBzdHJpbmdcclxuICApOiBPYnNlcnZhYmxlPENhbGxiYWNrQ29udGV4dD4ge1xyXG4gICAgcmV0dXJuIHRoaXMuaW1wbGljaXRGbG93Q2FsbGJhY2tIYW5kbGVyU2VydmljZVxyXG4gICAgICAuaW1wbGljaXRGbG93Q2FsbGJhY2soY29uZmlnLCBhbGxDb25maWdzLCBoYXNoKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMuaGlzdG9yeUp3dEtleXNDYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrSGlzdG9yeUFuZFJlc2V0Snd0S2V5cyhcclxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxyXG4gICAgICAgICAgICBjb25maWcsXHJcbiAgICAgICAgICAgIGFsbENvbmZpZ3NcclxuICAgICAgICAgIClcclxuICAgICAgICApLFxyXG4gICAgICAgIGNvbmNhdE1hcCgoY2FsbGJhY2tDb250ZXh0KSA9PlxyXG4gICAgICAgICAgdGhpcy5zdGF0ZVZhbGlkYXRpb25DYWxsYmFja0hhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrU3RhdGVWYWxpZGF0aW9uKFxyXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXHJcbiAgICAgICAgICAgIGNvbmZpZyxcclxuICAgICAgICAgICAgYWxsQ29uZmlnc1xyXG4gICAgICAgICAgKVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XHJcbiAgICAgICAgICB0aGlzLnVzZXJIYW5kbGVyU2VydmljZS5jYWxsYmFja1VzZXIoXHJcbiAgICAgICAgICAgIGNhbGxiYWNrQ29udGV4dCxcclxuICAgICAgICAgICAgY29uZmlnLFxyXG4gICAgICAgICAgICBhbGxDb25maWdzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKVxyXG4gICAgICApO1xyXG4gIH1cclxuXHJcbiAgcHJvY2Vzc1JlZnJlc2hUb2tlbihcclxuICAgIGNvbmZpZzogT3BlbklkQ29uZmlndXJhdGlvbixcclxuICAgIGFsbENvbmZpZ3M6IE9wZW5JZENvbmZpZ3VyYXRpb25bXSxcclxuICAgIGN1c3RvbVBhcmFtc1JlZnJlc2g/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZyB8IG51bWJlciB8IGJvb2xlYW4gfVxyXG4gICk6IE9ic2VydmFibGU8Q2FsbGJhY2tDb250ZXh0PiB7XHJcbiAgICByZXR1cm4gdGhpcy5yZWZyZXNoU2Vzc2lvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2VcclxuICAgICAgLnJlZnJlc2hTZXNzaW9uV2l0aFJlZnJlc2hUb2tlbnMoY29uZmlnKVxyXG4gICAgICAucGlwZShcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMucmVmcmVzaFRva2VuQ2FsbGJhY2tIYW5kbGVyU2VydmljZS5yZWZyZXNoVG9rZW5zUmVxdWVzdFRva2VucyhcclxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxyXG4gICAgICAgICAgICBjb25maWcsXHJcbiAgICAgICAgICAgIGN1c3RvbVBhcmFtc1JlZnJlc2hcclxuICAgICAgICAgIClcclxuICAgICAgICApLFxyXG4gICAgICAgIGNvbmNhdE1hcCgoY2FsbGJhY2tDb250ZXh0KSA9PlxyXG4gICAgICAgICAgdGhpcy5oaXN0b3J5Snd0S2V5c0NhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tIaXN0b3J5QW5kUmVzZXRKd3RLZXlzKFxyXG4gICAgICAgICAgICBjYWxsYmFja0NvbnRleHQsXHJcbiAgICAgICAgICAgIGNvbmZpZyxcclxuICAgICAgICAgICAgYWxsQ29uZmlnc1xyXG4gICAgICAgICAgKVxyXG4gICAgICAgICksXHJcbiAgICAgICAgY29uY2F0TWFwKChjYWxsYmFja0NvbnRleHQpID0+XHJcbiAgICAgICAgICB0aGlzLnN0YXRlVmFsaWRhdGlvbkNhbGxiYWNrSGFuZGxlclNlcnZpY2UuY2FsbGJhY2tTdGF0ZVZhbGlkYXRpb24oXHJcbiAgICAgICAgICAgIGNhbGxiYWNrQ29udGV4dCxcclxuICAgICAgICAgICAgY29uZmlnLFxyXG4gICAgICAgICAgICBhbGxDb25maWdzXHJcbiAgICAgICAgICApXHJcbiAgICAgICAgKSxcclxuICAgICAgICBjb25jYXRNYXAoKGNhbGxiYWNrQ29udGV4dCkgPT5cclxuICAgICAgICAgIHRoaXMudXNlckhhbmRsZXJTZXJ2aWNlLmNhbGxiYWNrVXNlcihcclxuICAgICAgICAgICAgY2FsbGJhY2tDb250ZXh0LFxyXG4gICAgICAgICAgICBjb25maWcsXHJcbiAgICAgICAgICAgIGFsbENvbmZpZ3NcclxuICAgICAgICAgIClcclxuICAgICAgICApXHJcbiAgICAgICk7XHJcbiAgfVxyXG59XHJcbiJdfQ==